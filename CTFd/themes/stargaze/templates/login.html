{% extends "base.html" %}

{% block content %}
<style>
  /* ─── LOGIN PAGE — INSERT TAPE (dark mode compatible) ─── */
  .login-page-wrap {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 1rem 3rem;
    position: relative;
    min-height: calc(100vh - 120px);
  }

  .cassette-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.06;
    z-index: 0;
  }

  .cassette-bg svg {
    width: min(80vw, 500px);
  }

  /* Card stack */
  .login-card-stack {
    position: relative;
    width: 100%;
    max-width: 430px;
    z-index: 1;
  }

  .login-card-stack::before,
  .login-card-stack::after {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 4px;
    box-shadow: 2px 2px 0 var(--shadow);
  }

  .login-card-stack::before {
    transform: rotate(-1.5deg) translate(6px, 4px);
  }

  .login-card-stack::after {
    transform: rotate(1.2deg) translate(-4px, 3px);
  }

  /* Main card */
  .login-card {
    position: relative;
    background: var(--panel);
    border: 1.5px solid var(--border);
    border-radius: 4px;
    padding: 2.4rem;
    z-index: 1;
    box-shadow: 4px 6px 0 var(--shadow), 0 12px 28px rgba(0, 0, 0, 0.1);
  }

  .login-tape-label {
    background: var(--accent2);
    color: var(--ink-brown);
    font-family: 'Special Elite', Georgia, serif;
    font-size: 0.72rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    text-align: center;
    padding: 0.35rem 1rem;
    margin: -2.4rem -2.4rem 1.8rem;
    border-bottom: 1px solid var(--border);
    opacity: 0.9;
  }

  [data-theme="dark"] .login-tape-label {
    color: var(--panel-dark);
  }

  .login-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-weight: 900;
    color: var(--text);
    text-align: center;
    font-size: 2rem;
    margin-bottom: 0.4rem;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
  }

  .login-subtitle {
    text-align: center;
    font-family: 'Courier Prime', monospace;
    font-size: 0.82rem;
    color: var(--text-muted);
    letter-spacing: 0.12em;
    margin-bottom: 2rem;
  }

  @keyframes tracking-flicker {
    0% {
      opacity: 0;
      transform: scaleX(1.02);
      filter: blur(1px);
    }

    20% {
      opacity: 0.7;
      transform: scaleX(0.99);
      filter: blur(0.3px);
    }

    40% {
      opacity: 0.4;
      transform: scaleX(1.01);
      filter: blur(0.8px);
    }

    70% {
      opacity: 0.9;
    }

    100% {
      opacity: 1;
      transform: scaleX(1);
      filter: blur(0);
    }
  }

  .login-form-area {
    animation: tracking-flicker 0.9s ease-out forwards;
  }

  .login-card .btn-primary::before {
    content: '▶ ';
  }

  .login-card a {
    font-size: 0.82rem;
    font-family: 'Courier Prime', monospace;
  }

  /* Lemon mascot */
  .login-lemon {
    position: fixed;
    bottom: 2.5rem;
    right: 2rem;
    opacity: 0.5;
    pointer-events: none;
    z-index: 10;
    animation: lemon-blink 8s 2s infinite;
  }

  @keyframes lemon-blink {

    0%,
    90%,
    100% {
      transform: scale(1);
    }

    92% {
      transform: scaleY(0.15) scaleX(1.1);
    }

    94% {
      transform: scale(1);
    }

    96% {
      transform: scaleY(0.1) scaleX(1.1);
    }

    98% {
      transform: scale(1);
    }
  }
</style>

<div class="login-page-wrap">
  <div class="cassette-bg" aria-hidden="true">
    <svg viewBox="0 0 520 280" xmlns="http://www.w3.org/2000/svg">
      <rect x="10" y="20" width="500" height="240" rx="18" fill="#3b2a1e" />
      <rect x="30" y="40" width="460" height="200" rx="10" fill="#efe2c6" />
      <circle cx="160" cy="140" r="70" fill="#d2b48c" stroke="#3b2a1e" stroke-width="4" />
      <circle cx="160" cy="140" r="40" fill="#3b2a1e" />
      <circle cx="160" cy="140" r="20" fill="#c4a962" />
      <circle cx="160" cy="140" r="8" fill="#3b2a1e" />
      <line x1="160" y1="100" x2="160" y2="120" stroke="#c4a962" stroke-width="3" />
      <line x1="180" y1="107" x2="170" y2="124" stroke="#c4a962" stroke-width="3" />
      <line x1="190" y1="125" x2="172" y2="132" stroke="#c4a962" stroke-width="3" />
      <circle cx="360" cy="140" r="70" fill="#d2b48c" stroke="#3b2a1e" stroke-width="4" />
      <circle cx="360" cy="140" r="40" fill="#3b2a1e" />
      <circle cx="360" cy="140" r="20" fill="#c4a962" />
      <circle cx="360" cy="140" r="8" fill="#3b2a1e" />
      <line x1="360" y1="100" x2="360" y2="120" stroke="#c4a962" stroke-width="3" />
      <line x1="380" y1="107" x2="370" y2="124" stroke="#c4a962" stroke-width="3" />
      <line x1="390" y1="125" x2="372" y2="132" stroke="#c4a962" stroke-width="3" />
      <rect x="220" y="80" width="80" height="50" rx="4" fill="#2f8f9d" opacity="0.4" />
      <text x="260" y="270" text-anchor="middle" font-family="Courier Prime, monospace" font-size="16" fill="#3b2a1e"
        letter-spacing="6">SIDE A</text>
    </svg>
  </div>

  <div class="login-card-stack">
    <div class="login-card">
      <div class="login-tape-label">▶ INSERT TAPE · SIDE A ◀</div>
      <h1 class="login-title">{% trans %}Login{% endtrans %}<span class="typewriter-cursor" aria-hidden="true"></span>
      </h1>
      <p class="login-subtitle">TRACKING… PLEASE AUTHENTICATE</p>

      <div class="login-form-area">
        {% include "components/errors.html" %}

        {% if integrations.mlc() %}
        <a class="btn btn-secondary btn-lg btn-block w-100 mb-3" href="{{ url_for('auth.oauth_login') }}">
          Login with Major League Cyber
        </a>
        <hr>
        {% endif %}

        {% with form = Forms.auth.LoginForm() %}
        <form method="post" accept-charset="utf-8">
          <div class="mb-3">
            <b>{{ form.name.label(class="form-label") }}</b>
            {{ form.name(class="form-control", value=name, autocomplete="username email") }}
          </div>
          <div class="mb-3">
            <b>{{ form.password.label(class="form-label") }}</b>
            {{ form.password(class="form-control", value=password, autocomplete="current-password") }}
          </div>
          <div class="row pt-3">
            <div class="col-6 col-md-8">
              <a class="align-middle" href="{{ url_for('auth.reset_password') }}">{% trans %}Forgot your password?{%
                endtrans %}</a>
            </div>
            <div class="col-6 col-md-4">
              {{ form.submit(class="btn btn-block btn-primary w-100") }}
            </div>
          </div>
          {{ form.nonce() }}
        </form>
        {% endwith %}
      </div>
    </div>
  </div>

  <div class="login-lemon" aria-hidden="true">
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="46" viewBox="0 0 28 32">
      <ellipse cx="14" cy="17" rx="10" ry="11" fill="#c4a962" stroke="#3b2a1e" stroke-width="1.5" />
      <ellipse cx="14" cy="7" rx="4" ry="6" fill="#c4a962" stroke="#3b2a1e" stroke-width="1" />
      <ellipse cx="14" cy="28" rx="3" ry="2.5" fill="#c56a2d" stroke="#3b2a1e" stroke-width="0.8" />
      <circle cx="11" cy="17" r="1.8" fill="#3b2a1e" />
      <circle cx="17" cy="17" r="1.8" fill="#3b2a1e" />
      <path d="M10,22 Q14,25 18,22" stroke="#3b2a1e" stroke-width="1.2" fill="none" stroke-linecap="round" />
      <circle cx="11.5" cy="16.5" r="0.5" fill="#efe2c6" />
      <circle cx="17.5" cy="16.5" r="0.5" fill="#efe2c6" />
    </svg>
  </div>
</div>
{% endblock %}