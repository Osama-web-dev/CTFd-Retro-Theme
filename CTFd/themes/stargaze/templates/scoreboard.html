{% extends "base.html" %}

{% block content %}
<style>
  /* ─── SCOREBOARD page styles ─── */
  .retro-board-wrap {
    background:
      repeating-linear-gradient(88deg, transparent 0px, transparent 18px, rgba(255, 255, 255, 0.012) 18px, rgba(255, 255, 255, 0.012) 19px),
      linear-gradient(160deg, #1a1410 0%, #12100e 35%, #16120c 70%, #0e0c0a 100%);
    border: 6px solid #0e0c0a;
    border-radius: 4px;
    padding: 0;
    box-shadow: inset 0 2px 12px rgba(0, 0, 0, 0.6), 0 8px 32px rgba(0, 0, 0, 0.5);
    position: relative;
    z-index: 5;
  }

  .retro-board-wrap::before {
    content: '◉ ◉';
    position: absolute;
    top: 10px;
    left: 14px;
    color: rgba(196, 169, 98, 0.3);
    font-size: 13px;
    letter-spacing: 22px;
    pointer-events: none;
    z-index: 1;
  }

  .retro-board-wrap::after {
    content: '◉ ◉';
    position: absolute;
    bottom: 10px;
    right: 14px;
    color: rgba(196, 169, 98, 0.3);
    font-size: 13px;
    letter-spacing: 22px;
    pointer-events: none;
    z-index: 1;
  }

  .board-inner {
    padding: 0 1.5rem 1.5rem;
  }

  .board-title-plaque {
    background: linear-gradient(180deg, #c4a962 0%, #a8883c 50%, #c4a962 100%);
    color: #12100e;
    font-family: 'Special Elite', Georgia, serif;
    font-size: 1.05rem;
    font-weight: 900;
    letter-spacing: 0.2em;
    text-align: center;
    padding: 0.6rem 2rem;
    margin-bottom: 1.5rem;
    border-bottom: 3px solid #7a5e18;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.6);
  }

  /* Score graph wrapper — position:relative z-index:10 to stay above all layers */
  .score-graph-wrap {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 0.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
    position: relative;
    z-index: 10;
  }

  /* The actual graph div — NO z-index tricks needed; parent handles it */
  #scoreboard-graph {
    position: relative;
    z-index: 10;
    min-height: 200px;
  }

  /* Scoreboard table */
  .retro-board-wrap .table {
    background: var(--panel) !important;
    border: 1px solid var(--border);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    border-radius: 3px;
  }

  .retro-board-wrap .table thead th {
    background: #0e0c0a;
    color: var(--accent) !important;
  }

  .retro-board-wrap .table tbody tr td,
  .retro-board-wrap .table tbody tr th {
    color: var(--text) !important;
  }

  .retro-board-wrap .table tbody tr:hover {
    background-color: rgba(196, 169, 98, 0.06) !important;
  }

  /* 1st place */
  .retro-board-wrap .table tbody tr:first-child th {
    color: var(--accent) !important;
    font-size: 1.1em;
  }

  .retro-board-wrap .table tbody tr:first-child th::before {
    content: '♛ ';
  }

  .retro-board-wrap .table tbody tr:first-child {
    animation: gold-shimmer 3s ease-in-out infinite;
  }

  /* Nav pills on dark board */
  .retro-board-wrap .nav-pills .nav-link {
    color: rgba(244, 234, 213, 0.7);
    background: rgba(244, 234, 213, 0.04);
    border: 1px solid rgba(196, 169, 98, 0.15);
    margin: 3px;
    font-size: 0.85rem;
  }

  .retro-board-wrap .nav-pills .nav-link:hover {
    background: rgba(196, 169, 98, 0.12);
    color: var(--accent);
  }

  .retro-board-wrap .nav-pills .nav-link.active {
    background: var(--accent) !important;
    color: var(--bg) !important;
  }

  .retro-board-wrap h3.text-muted {
    color: rgba(244, 234, 213, 0.4) !important;
  }
</style>

<div class="jumbotron">
  <div class="container">
    <h1>{% trans %}Scoreboard{% endtrans %}</h1>
  </div>
</div>

<div class="container my-4">
  {% include "components/errors.html" %}

  <div class="retro-board-wrap">
    <div class="board-title-plaque">★ HALL OF HACKERS ★</div>
    <div class="board-inner">

      <!-- Score Graph — exact CTFd Alpine structure preserved -->
      <div class="row">
        <div class="col-md-12">
          <div class="score-graph-wrap">
            <div id="score-graph" class="align-items-center" :class="{'d-flex': show, 'd-none': !show}"
              x-data="ScoreboardDetail" x-ref="scoregraph"
              @bracket-change.window="activeBracket=$event.detail; update();">
              <div class="col-md-12 text-center">
                <i class="fas fa-circle-notch fa-spin fa-3x fa-fw" style="color:var(--accent);"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Scoreboard List — exact CTFd Alpine structure preserved -->
      <div class="row">
        <div class="col-md-12" id="scoreboard" x-data="ScoreboardList">
          <template x-if="brackets.length && standings.length">
            <div class="py-3">
              <nav class="nav nav-pills nav-fill">
                <button :class="{'nav-link': true, 'active': !activeBracket}" @click="activeBracket=null">{% trans
                  %}All{% endtrans %}</button>
                <template x-for="bracket in brackets">
                  <button :class="{'nav-link': true, 'active': activeBracket == bracket.id}" x-text="bracket.name"
                    @click="activeBracket=bracket.id"></button>
                </template>
              </nav>
            </div>
          </template>

          <div x-show="standings.length">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th style="width:10px">{% trans %}Place{% endtrans %}</th>
                  <th class="text-start ps-3">{{ get_mode_as_word(capitalize=True) }}</th>
                  <th>{% trans %}Score{% endtrans %}</th>
                </tr>
              </thead>
              <tbody>
                <template
                  x-for="(standing, index) in standings.filter(i => activeBracket ? i.bracket_id==activeBracket : true)">
                  <tr>
                    <th scope="row" class="text-center" x-text="index + 1"></th>
                    <td class="text-start">
                      <a :href="standing.account_url" x-text="standing.name"></a>
                      <template x-if="standing.bracket_name">
                        <span class="badge bg-secondary ms-2" x-text="standing.bracket_name"></span>
                      </template>
                    </td>
                    <td x-text="standing.score"></td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>

          <div x-show="!standings.length">
            <h3 class="text-center text-muted py-4">{% trans %}Scoreboard is empty{% endtrans %}</h3>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
{{ Assets.js("assets/js/scoreboard.js") }}
{% endblock %}